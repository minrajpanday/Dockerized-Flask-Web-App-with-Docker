

services:
  web:
    # Use the Dockerfile in the current directory (where docker-compose.yml is)
    build: .
    
    # Name the resulting container
    container_name: flask_web_app
    
    # Map HOST_PORT:CONTAINER_PORT
    # We use a variable for the host port, defaulting to 5000:5000
    ports:
      - "${APP_PORT:-5000}:5000"

    environment:
      # This is the new, dynamic part!
      - CUSTOM_MESSAGE=Hello from the Master branch Docker Compose setup!


    # Load environment variables from the .env file
    env_file:
      - ./.env

    # Define a simple healthcheck (BEST PRACTICE)
    # Checks if the /health endpoint returns a 200 status code every 30 seconds.
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 5